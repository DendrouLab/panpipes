<style>
  .parameter {
    border-top: 4px solid lightblue;
    background-color: rgba(173, 216, 230, 0.2);
    padding: 4px;
    display: inline-block;
    font-weight: bold;
  }
</style>

# Integration YAML 

This documentation explains the parameters of the `integration` configuration yaml file generated by running the `panpipes integration config`.<br> The steps to run the pipeline are described in the [integration workflow](docs/workflows/integration.md). 

When running the integration workflow, panpipes provides you with a basic `pipeline.yml` file. To run the workflow with your own data you need to specify the parameters described below in the `pipeline.yml` file to meet the requirements of your data. However, we do provide pre-filled versions of the `pipeline.yml` for individual [tutorials](https://panpipes-pipelines.readthedocs.io/en/latest/tutorials/index.html).

You can download the different integration pipeline.yml files here:
- Basic `pipeline.yml` file (not pre-filled) that is generated when calling `panpipes integration config`: (Download here)[https://github.com/DendrouLab/panpipes/blob/main/panpipes/panpipes/pipeline_integration/pipeline.yml]
- `pipeline.yml`for [Integration tutorial](https://panpipes-tutorials.readthedocs.io/en/latest/uni_multi_integration/pipeline_yml.html)


## Compute resources options

* <p class="parameter">resources</p>
  
    Computing resources to use, specifically the number of threads used for parallel jobs.
    Specified by the following three parameters:

  - <p class="parameter">threads_high</p> Integer, Default: 1
        <p>Number of threads used for high intensity computing tasks. 
        For each thread, there must be enough memory to load your MuData object which was created in the preprocessing step of the workflow.
        </p><br>
  
  - <p class="parameter">threads_medium</p> Integer, Default: 1
        <p>Number of threads used for medium intensity computing tasks.
        For each thread, there must be enough memory to load your mudata and do computationally light tasks.
        </p><br>
  
  - <p class="parameter">threads_low</p> Integer, Default: 1
  	    <p>Number of threads used for low intensity computing tasks.
        For each thread, there must be enough memory to load text files and do plotting, requires much less memory than the other two.
        </p><br>

  - <p class="parameter">threads_gou</p> Integer, Default: 2
        <p>Number of gpu used for computing tasks.
        For each thread, there must be enough memory to compute the tasks above. (ASKKKKKKKKKKKKKKK)

* <p class="parameter">condaenv</p> String
  
    Path to conda environment that should be used to run panpipes.
    Leave blank if running native or your cluster automatically inherits the login node environment

## Loading and merging data options
### Data format


* <p class="parameter">sample_prefix</p> String, Default: "test"
    
    Prefix for the sample that comes out of the filtering/ preprocessing steps of the workflow.

* <p class="parameter">preprocessed_obj</p> String, Mandatory parameter
    
    Path to the output file from preprocessing (e.g. ../preprocess/test.h5mu).
    Ensure that the submission file must be in the right format and that the right path is provided.

### Batch correction

* <p class="parameter">rna:</p>
      * <p class="parameter">run</p> Boolean, Default: True
      Defines if you want the batch correction to run 

      * <p class="parameter">tools</p> String (comma-separated), Default: harmony,bbknn,scanorama,scvi 
      Defines the method used to run batch correction, multiple can be selected.
      choices: harmony,bbknn,scanorama,scvi

       * <p class="parameter">column</p> String (comma-separated), Default: sample_id
       The column you want to batch correct on, if a comma-separated list is specified then all will be used simultaneously

  ### Harmony arguments
  
* <p class="parameter">harmony:</p>
            Basic parameters required to run harmony 
       * <p class="parameter">sigma</p> Float, Default: 0.1
       * <p class="parameter">theta</p> Float, Default: 1.0
       * <p class="parameter">npcs</p> Integer, Default: 30

  ### BBKNN arguments
Check https://bbknn.readthedocs.io/en/latest/ for more information 
  * <p class="parameter">exclude_mt_genes:</p> 

  ### SCVI arguments
  * <p class="parameter">rna:</p>
        * <p class="parameter">exclude_mt_genes:</p> Boolean, Default: True
        * <p class="parameter">exclude_mt_genes:</p> String, Default: mt
        
        * <p class="parameter">model_args:</p>
                * <p class="parameter">n_layers:</p>
                * <p class="parameter">n_latent:</p>
                * <p class="parameter">gene_likelihood:</p> String, Default: zinb
        * <p class="parameter">training_agrs:</p>
                * <p class="parameter">max_epochs:</p> Integer, Default: 400
                * <p class="parameter">train_size:</p> Float, Default: 0.9
                * <p class="parameter">early_stopping:</p> Boolean, Default: True
        * <p class="parameter">training_plan:</p>
                * <p class="parameter">lr:</p> Float, Default:0.001
                * <p class="parameter">n_epochs_kl_warmup:</p> Integer, Default: 400
                * <p class="parameter">reduce_lr_on_plateau:</p> Boolean, Default: True
                * <p class="parameter">lr_scheduler_metric</p>
                * <p class="parameter">lr_patience</p> integer, Default: 8
                * <p class="parameter">lr_factor</p> Float, Default: 0.1
### Find neighbour parameters 

            

                
    

