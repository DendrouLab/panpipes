<style>
  .parameter {
    border-top: 4px solid lightblue;
    background-color: rgba(173, 216, 230, 0.2);
    padding: 4px;
    display: inline-block;
    font-weight: bold;
  }
</style>
 
# Integration YAML 

This documentation explains the parameters of the `integration` configuration yaml file generated by running the `panpipes integration config`.<br> The steps to run the pipeline are described in the [integration workflow](docs/workflows/integration.md). 

When running the integration workflow, panpipes provides you with a basic `pipeline.yml` file. To run the workflow with your own data you need to specify the parameters described below in the `pipeline.yml` file to meet the requirements of your data. However, we do provide pre-filled versions of the `pipeline.yml` for individual [tutorials](https://panpipes-pipelines.readthedocs.io/en/latest/tutorials/index.html).

You can download the different integration pipeline.yml files here:
- Basic `pipeline.yml` file (not pre-filled) that is generated when calling `panpipes integration config`: (Download here)[https://github.com/DendrouLab/panpipes/blob/main/panpipes/panpipes/pipeline_integration/pipeline.yml]
- `pipeline.yml`for [Integration tutorial](https://panpipes-tutorials.readthedocs.io/en/latest/uni_multi_integration/pipeline_yml.html)


## Compute resources options

* <p class="parameter">resources</p>
  
    Computing resources to use, specifically the number of threads used for parallel jobs.
    Specified by the following three parameters:

  - <p class="parameter">threads_high</p> Integer, Default: 1
        Number of threads used for high intensity computing tasks. 
        For each thread, there must be enough memory to load your MuData object which was created in the preprocessing step of the workflow.
        </p><br>
  
  - <p class="parameter">threads_medium</p> Integer, Default: 1
        <p>Number of threads used for medium intensity computing tasks.
        For each thread, there must be enough memory to load your mudata and do computationally light tasks.
        </p><br>
  
  - <p class="parameter">threads_low</p> Integer, Default: 1
  	    <p>Number of threads used for low intensity computing tasks.
        For each thread, there must be enough memory to load text files and do plotting, requires much less memory than the other two.
        </p><br>

  - <p class="parameter">threads_gou</p> Integer, Default: 2
        <p>Number of gpu used for computing tasks.
        For each thread, there must be enough memory to compute the tasks above. (ASKKKKKKKKKKKKKKK)

* <p class="parameter">condaenv</p> String
  
    Path to conda environment that should be used to run panpipes.
    Leave blank if running native or your cluster automatically inherits the login node environment

## Loading and merging data options
### Data format


* <p class="parameter">sample_prefix</p> String, Default: "test"
    
    Prefix for the sample that comes out of the filtering/ preprocessing steps of the workflow.

* <p class="parameter">preprocessed_obj</p> String, Mandatory parameter
    
    Path to the output file from preprocessing (e.g. ../preprocess/test.h5mu).
    Ensure that the submission file must be in the right format and that the right path is provided.

### Batch correction

* <p class="parameter">rna:</p> 
  Batch correction is specified by the following parameters:
  
   - <p class="parameter">run</p> Boolean, Default: True 
        <p>Defines if you want the batch correction to run 
          </p><br>
   - <p  class="parameter">tools</p> String (comma-separated), Default: harmony,bbknn,scanorama,scvi 
          <p>Defines the method used to run batch correction, multiple can be selected.
           choices: harmony,bbknn,scanorama,scvi
           </p><br>
    - <p class="parameter">column</p> String (comma-separated), Default: sample_id

     The column you want to batch correct on, if a comma-separated list is specified then all will be used simultaneously
 
  ### Harmony arguments
  
- <span class="parameter">harmony:</p>
    Basic parameters required to run harmony:
   
    - <span class="parameter">sigma</span> Float, Default: 0.1<br>
    - <span class="parameter">theta</span> Float, Default: 1.0<br>
    - <span class="parameter">npcs</span> Integer, Default: 30<br>

  
  ### BBKNN arguments
Check https://bbknn.readthedocs.io/en/latest/ for more information 
   <span class="parameter">exclude_mt_genes:</span> 

  ### SCVI arguments
   <span class="parameter">rna</span>
  SCVI parameters are specified as: 
  
  - <span  class="parameter">exclude_mt_genes:</span> `Boolean`, Default: True
  - <span  class="parameter">exclude_mt_genes:</span> `String`, Default: mt
   

    <span class="parameter">model_args:</span>
    Model argument parameters:
       - <span class="parameter">n_layers:</span> `Float`, Default: 1.0
      
       - <span class="parameter">n_latent:</span> `Integer`, Default: 10
    
       - <span class="parameter">gene_likelihood:</span> `String`, Default: zinb
    
    <span class="parameter">training_agrs</p>:
    Training argument parameters:
       - <span class="parameter">max_epochs:</span> `Integer`, Default: 400
         
       - <span class="parameter">train_size</span> `Float`, Default: 0.9
         
       - <span class="parameter">early_stopping:</span> `Boolean`, Default: True
    
    <span class="parameter">training_plan:</p>:
    Training plan parameters:
       - <span class="parameter">lr:</span> `Float`, Default:0.001
         
       - <span class="parameter">n_epochs_kl_warmup:</span> `Integer`, Default: 40
         
       - <span class="parameter">reduce_lr_on_plateau:</span> `Boolean`, Default: True
  
       - <span class="parameter">lr_scheduler_metric</span> (HEREEEEEEE)
    
       - <span class="parameter">lr_patience</span> `Integer`, Default: 8
         
       - <span class="parameter">lr_factor</span> `Float`, Default: 0.1
    
### Find neighbour parameters 
 <span class="parameter">neighbors:</span> `String`, Default: &atac_neighbors
 
 <span class="parameter">npcs</span> `Integer`, Default: 30   
   Number of principal components to calculate for neighbors and Umap
  
  <span class="parameter">k</span> `Integer`, Default: 30
  Number of neighbors
  
  <span class="parameter">metric</span> `String`, Default: euclidean
   Metric can be either euclidean or cosine
  
  <span class="parameter">methof</span> `String`, Default: scanpy
    The method can either be scanpy or hnsw
         
### Multimodal integration             
 <span class="parameter">run</span> `Boolean`, Default: True<br>
 Leave False if you don't want to run multimodal integration 

  <span class="parameter">tools</span> `String`(Comma separated), Default: "WNN" <br>
 Method you want to use to run batch correction. Options include: WNN, totalvi and multiVI. You can specify mutiple. 

 <span class="parameter">column_categorical</span> `String`(Comma separated), Default: sample_id <br>
 This is the column you want to run a batch correction on, multiple can be selected simultaneously. 

 Extra parameters: 
 <span class="parameter">totalvi:</span> 
   These are the basic totalvi parameters required, you can add more if it fits your analysis better. 

   -  <span class="parameter">modalities</span> `String`(Comma separated), Default: rna, prot <br>
  totalvi has to run on both rna and protein data
  
   -  <span class="parameter">exclude_mt_genes</span> `Boolean`, Default: True <br>
   -  <span class="parameter">mr_column</span> `String`, Default: mt <br>
   -  <span class="parameter">filter_by_hvg</span> `Boolean`, Default: True <br>
   To filter manually create a column called prot_outliers in mdata['prot']
   -  <span class="parameter">filter_prot_outliers</span> `Boolean`, Default: False <br>
   -  <span class="parameter">model_args</span>:
      -  <span class="parameter">latent_distribution</span>`String`, Default: "normal" <br>
  -  <span class="parameter">training_args</span>:
      -  <span class="parameter">max_epochs</span>`Integer`, Default: 100 <br>
      -  <span class="parameter">train_size</span>`Float`, Default: 0.9 <br>
      -  <span class="parameter">early_stopping</span> `Boolean`, Default: True <br>
  -  <span class="parameter">training_args</span> `String`, Default: Nonw <br>



 <span class="parameter">MultiVi:</span>:
 
